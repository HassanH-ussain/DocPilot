<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Physician Dashboard - Patient Management System</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/header-auth.css">
</head>
<body>
    <!-- Authentication Check Script -->
    <script>
        // Immediate authentication check - redirect if not authenticated
        (function() {
            try {
                const authData = localStorage.getItem('physicianDashboardAuth');
                if (!authData) {
                    window.location.href = 'login.html';
                    return;
                }
                
                const parsed = JSON.parse(authData);
                const now = new Date().getTime();
                const expiration = new Date(parsed.expiresAt).getTime();
                
                if (now >= expiration) {
                    localStorage.removeItem('physicianDashboardAuth');
                    localStorage.removeItem('physicianDashboardRemember');
                    window.location.href = 'login.html';
                    return;
                }
            } catch (error) {
                console.error('Auth check error:', error);
                window.location.href = 'login.html';
            }
        })();
    </script>

    <div class="container">
        <!-- Header Section -->
        <header class="header">
            <div class="header-left">
                <h1>üè• Physician Dashboard</h1>
            </div>
            <div class="header-info">
                <div id="doctorName">Dr. John Smith, MD</div>
                <div id="currentDate"></div>
                <!-- Logout button will be added dynamically -->
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="nav-tabs">
            <button class="tab-btn active" onclick="switchTab('dashboard')">Dashboard</button>
            <button class="tab-btn" onclick="switchTab('patients')">Patients</button>
            <button class="tab-btn" onclick="switchTab('examinations')">Examinations</button>
            <button class="tab-btn" onclick="switchTab('files')">Files & Scans</button>
        </nav>

        <!-- Dashboard Tab -->
        <main id="dashboard" class="tab-content active">
            <h2>Dashboard Overview</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalPatientsCount">0</div>
                    <div>Total Patients</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="todayExamsCount">0</div>
                    <div>Today's Examinations</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalFilesCount">0</div>
                    <div>Total Files</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="pendingReviewsCount">3</div>
                    <div>Pending Reviews</div>
                </div>
            </div>
            
            <!-- Dashboard Alerts Container (dynamically added) -->
            
            <section class="recent-activity-section">
                <h3>Recent Activity</h3>
                <div id="recentActivity" class="examination-history">
                    <p>No recent activity</p>
                </div>
            </section>
        </main>

        <!-- Patients Tab -->
        <main id="patients" class="tab-content">
            <h2>Patient Management</h2>
            
            <div class="action-buttons">
                <button class="btn" onclick="openPatientModal()">Add New Patient</button>
                <button class="btn btn-secondary" onclick="editSelectedPatient()">Edit Selected</button>
                <button class="btn btn-danger" onclick="deleteSelectedPatient()">Delete Selected</button>
            </div>
            
            <input type="text" class="search-bar" placeholder="Search patients..." oninput="searchPatients(this.value)">
            
            <div id="patientsList" class="patient-list">
                <!-- Patients will be dynamically loaded here -->
            </div>
        </main>

        <!-- Examinations Tab -->
        <main id="examinations" class="tab-content">
            <h2>Patient Examinations</h2>
            
            <div id="selectedPatientInfo">
                <p>Please select a patient from the Patients tab to view/add examinations.</p>
            </div>
            
            <div id="examinationForm" style="display: none;">
                <h3>Add New Examination</h3>
                <form onsubmit="addExamination(event)">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="examDate">Examination Date:</label>
                            <input type="datetime-local" id="examDate" required>
                        </div>
                        <div class="form-group">
                            <label for="examType">Examination Type:</label>
                            <select id="examType" required>
                                <option value="">Select Type</option>
                                <option value="routine">Routine Checkup</option>
                                <option value="follow-up">Follow-up</option>
                                <option value="consultation">Consultation</option>
                                <option value="emergency">Emergency</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="bloodPressure">Vital Signs - Blood Pressure:</label>
                            <input type="text" id="bloodPressure" placeholder="120/80">
                        </div>
                        <div class="form-group">
                            <label for="heartRate">Heart Rate (BPM):</label>
                            <input type="number" id="heartRate" placeholder="72">
                        </div>
                        <div class="form-group">
                            <label for="temperature">Temperature (¬∞F):</label>
                            <input type="number" step="0.1" id="temperature" placeholder="98.6">
                        </div>
                        <div class="form-group">
                            <label for="weight">Weight (lbs):</label>
                            <input type="number" step="0.1" id="weight">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="chiefComplaint">Chief Complaint:</label>
                        <textarea id="chiefComplaint" rows="3" placeholder="Patient's main concern or reason for visit"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="physicalFindings">Physical Examination Findings:</label>
                        <textarea id="physicalFindings" rows="4" placeholder="Physical examination results"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="diagnosis">Diagnosis:</label>
                        <textarea id="diagnosis" rows="3" placeholder="Primary and secondary diagnoses"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="treatmentPlan">Treatment Plan:</label>
                        <textarea id="treatmentPlan" rows="4" placeholder="Treatment recommendations and medications"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="followUpInstructions">Follow-up Instructions:</label>
                        <textarea id="followUpInstructions" rows="3" placeholder="Next steps and follow-up appointments"></textarea>
                    </div>
                    
                    <button type="submit" class="btn">Add Examination</button>
                </form>
            </div>
            
            <div id="examinationHistory" class="examination-history">
                <!-- Examination history will be displayed here -->
            </div>
        </main>

        <!-- Files Tab -->
        <main id="files" class="tab-content">
            <h2>Files & Medical Scans</h2>
            
            <div id="fileSelectedPatientInfo">
                <p>Please select a patient from the Patients tab to manage files.</p>
            </div>
            
            <div id="fileManagement" style="display: none;">
                <div class="file-upload-area" onclick="document.getElementById('fileInput').click()">
                    <h3>üìÅ Upload Medical Files</h3>
                    <p>Click here or drag files to upload medical records, scans, lab results, etc.</p>
                    <input type="file" id="fileInput" multiple accept="image/*,.pdf,.doc,.docx" style="display: none;" onchange="handleFileUpload(event)">
                </div>
                
                <div id="fileList" class="file-list">
                    <!-- Uploaded files will be displayed here -->
                </div>
            </div>
        </main>
    </div>

    <!-- Patient Modal -->
    <div id="patientModal" class="modal" role="dialog" aria-labelledby="modalTitle">
        <div class="modal-content">
            <button class="close-modal" onclick="closePatientModal()" aria-label="Close">&times;</button>
            <h2 id="modalTitle">Add New Patient</h2>
            <form onsubmit="savePatient(event)">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="firstName">First Name:</label>
                        <input type="text" id="firstName" required>
                    </div>
                    <div class="form-group">
                        <label for="lastName">Last Name:</label>
                        <input type="text" id="lastName" required>
                    </div>
                    <div class="form-group">
                        <label for="dateOfBirth">Date of Birth:</label>
                        <input type="date" id="dateOfBirth" required>
                    </div>
                    <div class="form-group">
                        <label for="gender">Gender:</label>
                        <select id="gender" required>
                            <option value="">Select Gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="phoneNumber">Phone Number:</label>
                        <input type="tel" id="phoneNumber" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" id="email">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="address">Address:</label>
                    <textarea id="address" rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="medicalHistory">Medical History:</label>
                    <textarea id="medicalHistory" rows="4" placeholder="Previous conditions, surgeries, allergies, medications"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="insuranceInfo">Insurance Information:</label>
                    <input type="text" id="insuranceInfo" placeholder="Insurance provider and policy number">
                </div>
                
                <div class="modal-actions">
                    <button type="submit" class="btn">Save Patient</button>
                    <button type="button" class="btn btn-secondary" onclick="closePatientModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Load JavaScript Files in Proper Order -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/data.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/patients.js"></script>
    <script src="js/examinations.js"></script>
    <script src="js/files.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/debug-tabs.js"></script>
    <script src="js/app.js"></script>
</body>
</html>